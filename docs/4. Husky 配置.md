# Husky + lint-staged 配置

## 依赖包

| 包名          | 说明                                    |
| ------------- | --------------------------------------- |
| `husky`       | Git hooks 工具，在 commit 时触发脚本    |
| `lint-staged` | 只对暂存的文件运行 linter，提高检查速度 |

## 配置文件

### .husky/pre-commit

```bash
pnpm exec lint-staged
```

### lint-staged.config.js

```javascript
export default {
  '*.{js,ts,tsx}': ['eslint --fix'],
}
```

## 工作流程

```
git commit
    │
    ▼
pre-commit hook (husky)
    │
    ▼
lint-staged
    │
    ▼
eslint --fix (只检查暂存的文件)
    │
    ├─ 通过 → 提交成功
    └─ 失败 → 提交中止
```

## lint vs lint-staged 对比

### 区别

| 对比项   | `pnpm run lint`      | `lint-staged` (pre-commit) |
| -------- | -------------------- | -------------------------- |
| 触发时机 | 手动运行             | Git commit 时自动运行      |
| 检查范围 | **所有文件**         | **只检查暂存的文件**       |
| 修复方式 | 不自动修复（只报错） | `--fix` 自动修复           |
| 用途     | CI/CD、全局检查      | 提交前快速检查             |

### 使用场景

#### `pnpm run lint`（全局检查）

```bash
# 1. CI/CD 中检查
pnpm run lint

# 2. 检查整个项目
pnpm run lint

# 3. 查看所有 lint 问题
pnpm run lint
```

**用于：**

- CI/CD 流水线
- 代码审查前的全面检查
- 新成员加入时检查整个代码库

#### `lint-staged`（增量检查）

```bash
# Git commit 时自动运行
git commit -m "fix: bug"
# → 只检查本次修改的文件
```

**用于：**

- 提交前快速检查修改的文件
- 自动修复简单问题
- 提高开发体验

## 初始化命令

```bash
# 安装依赖
pnpm add -w -D husky lint-staged

# 初始化 husky
pnpm exec husky init

# 修改 .husky/pre-commit 文件内容为:
# pnpm exec lint-staged
```

## lint-staged 配置语法

```javascript
export default {
  // 匹配模式: [命令数组]
  '*.{js,ts,tsx}': ['eslint --fix'],

  // 多个命令按顺序执行
  '*.{js,ts}': ['eslint --fix', 'prettier --write'],

  // 不同文件类型不同命令
  '*.ts': ['eslint --fix'],
  '*.css': ['stylelint --fix'],
  '*.md': ['prettier --write'],
}
```

## 跳过检查

```bash
# 紧急情况下跳过 hook（不推荐）
git commit --no-verify -m "message"
```

## 官方文档

- [Husky](https://typicode.github.io/husky/)
- [lint-staged](https://github.com/lint-staged/lint-staged)
- [ESLint CLI 参数](https://eslint.org/docs/latest/use/command-line-interface)
