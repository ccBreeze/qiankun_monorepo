# 基础

## Monorepo 依赖准则

## ✅ 允许的依赖关系

1. **apps → packages**

   - apps 可以引用 packages 中的包
   - 示例：`ex-app` 引用 `@learn-monorepo/utils`

2. **packages → packages**
   - packages 之间可以相互引用
   - 示例：`@learn-monorepo/ui` 引用 `@learn-monorepo/utils`

### 依赖层级关系

```
┌─────────────────────────────────┐
│          apps (应用层)           │
│  ┌─────────┐      ┌─────────┐  │
│  │ ex-app  │      │ web-app │  │
│  └────┬────┘      └────┬────┘  │
└───────┼────────────────┼────────┘
        │                │
        ▼                ▼
┌─────────────────────────────────┐
│      packages (共享层)           │
│  ┌─────────┐      ┌─────────┐  │
│  │  utils  │◄────►│   ui    │  │
│  └─────────┘      └─────────┘  │
└─────────────────────────────────┘
```

## 在 monorepo 中安装内部包的正确命令

### 方法 1：在子包目录下安装

```bash
cd apps/ex-app
# 不可使用简写 -w
pnpm add @learn-monorepo/utils --workspace

# 或者
# pnpm add '@learn-monorepo/utils@workspace:\*'
```

### 方法 2：在根目录使用 filter

`pnpm --filter ex-app add '@learn-monorepo/utils@workspace:\*'`

关键要点：

1. ✅ 使用 workspace:\* 协议指定这是 workspace 内部包
2. ✅ 用引号包裹包名，避免 \* 被 shell 当作通配符
3. ✅ 其他版本指定方式：
   - `workspace:\*` - 任意版本
   - `workspace:^` - 兼容版本范围
   - `workspace:~` - 补丁版本范围
   - `workspace:1.0.0` - 精确版本
