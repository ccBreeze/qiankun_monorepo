# Prettier 配置

## 依赖包

```json
{
  "devDependencies": {
    "prettier": "^3.7.4",
    "eslint-config-prettier": "^10.1.8",
    "eslint-plugin-prettier": "^5.5.4"
  }
}
```

| 包名                     | 说明                                 |
| ------------------------ | ------------------------------------ |
| `prettier`               | Prettier 核心包                      |
| `eslint-config-prettier` | 关闭 ESLint 中与 Prettier 冲突的规则 |
| `eslint-plugin-prettier` | 将 Prettier 作为 ESLint 规则运行     |

## 配置文件

### .prettierrc

```json
{
  "semi": true,
  "singleQuote": true,
  "tabWidth": 2,
  "printWidth": 120
}
```

| 选项          | 值     | 说明                |
| ------------- | ------ | ------------------- |
| `semi`        | `true` | 语句末尾添加分号    |
| `singleQuote` | `true` | 使用单引号          |
| `tabWidth`    | `2`    | 缩进宽度为 2 个空格 |
| `printWidth`  | `120`  | 每行最大字符数      |

### eslint.config.js

```javascript
// @ts-check
import { defineConfig } from 'eslint/config'
import eslint from '@eslint/js'
import tseslint from 'typescript-eslint'
import prettier from 'eslint-config-prettier'
import prettierPlugin from 'eslint-plugin-prettier'

export default defineConfig([
  // ESLint 推荐规则
  eslint.configs.recommended,

  // TypeScript 推荐规则
  tseslint.configs.recommended,

  // Prettier 配置（关闭与 Prettier 冲突的规则）
  prettier,

  // Prettier 插件（将 Prettier 作为 ESLint 规则运行）
  {
    plugins: {
      prettier: prettierPlugin,
    },
    rules: {
      'prettier/prettier': 'error',
    },
  },

  // 忽略文件
  {
    ignores: ['node_modules/', 'pnpm-lock.yaml', 'dist/', 'build/', '*.config.js'],
  },
])
```

## ESLint + Prettier 协同工作

### 配置顺序（重要）

```javascript
export default defineConfig([
  eslint.configs.recommended,      // 1. ESLint 规则
  tseslint.configs.recommended,    // 2. TypeScript 规则
  prettier,                        // 3. 关闭冲突规则（必须在规则之后）
  { plugins: { prettier }, ... },  // 4. Prettier 插件
])
```

### 工作原理

```
┌─────────────────────────────────────────────────────────────┐
│                      ESLint 检查流程                         │
├─────────────────────────────────────────────────────────────┤
│  1. eslint.configs.recommended                              │
│     └─ 检查 JavaScript 代码质量                              │
│                                                             │
│  2. tseslint.configs.recommended                            │
│     └─ 检查 TypeScript 代码质量                              │
│                                                             │
│  3. eslint-config-prettier                                  │
│     └─ 关闭与 Prettier 冲突的格式化规则                       │
│                                                             │
│  4. eslint-plugin-prettier                                  │
│     └─ 运行 Prettier 检查，格式问题报为 ESLint error          │
└─────────────────────────────────────────────────────────────┘
```

### 职责分工

| 工具                       | 职责                                     |
| -------------------------- | ---------------------------------------- |
| **ESLint**                 | 代码质量（错误、最佳实践、未使用变量等） |
| **Prettier**               | 代码格式（缩进、引号、分号、换行等）     |
| **eslint-config-prettier** | 避免冲突（关闭 ESLint 的格式化规则）     |
| **eslint-plugin-prettier** | 统一入口（通过 ESLint 运行 Prettier）    |

## 运行命令

```bash
# 检查代码（质量 + 格式）
pnpm run lint

# 自动修复
pnpm eslint . --fix

# 仅格式化（使用 Prettier 直接运行）
pnpm run format
```

### package.json scripts

```json
{
  "scripts": {
    "lint": "eslint . --max-warnings=0",
    "format": "prettier --config .prettierrc '.' --write"
  }
}
```

## 两种集成方式对比

### 方式 1：仅使用 eslint-config-prettier（推荐用于大型项目）

```javascript
import prettier from 'eslint-config-prettier'

export default defineConfig([
  eslint.configs.recommended,
  tseslint.configs.recommended,
  prettier, // 只关闭冲突规则
])
```

**优点：**

- 速度更快（ESLint 和 Prettier 独立运行）
- 错误信息更清晰
- 可以分别运行 `lint` 和 `format`

**缺点：**

- 需要运行两个命令

### 方式 2：使用 eslint-plugin-prettier（当前配置）

```javascript
import prettier from 'eslint-config-prettier'
import prettierPlugin from 'eslint-plugin-prettier'

export default defineConfig([
  eslint.configs.recommended,
  tseslint.configs.recommended,
  prettier,
  {
    plugins: { prettier: prettierPlugin },
    rules: { 'prettier/prettier': 'error' },
  },
])
```

**优点：**

- 一条命令检查所有问题
- `--fix` 同时修复代码质量和格式问题
- CI/CD 中只需运行一个检查

**缺点：**

- 速度稍慢
- 错误信息可能较长

## 常用 Prettier 配置选项

```json
{
  "semi": true, // 分号
  "singleQuote": true, // 单引号
  "tabWidth": 2, // 缩进宽度
  "printWidth": 120, // 行宽
  "trailingComma": "es5", // 尾随逗号
  "bracketSpacing": true, // 对象括号空格
  "arrowParens": "always", // 箭头函数参数括号
  "endOfLine": "lf", // 换行符
  "jsxSingleQuote": false, // JSX 使用双引号
  "proseWrap": "preserve" // Markdown 换行
}
```

## 官方文档

| 文档                   | 链接                                                         |
| ---------------------- | ------------------------------------------------------------ |
| Prettier 官网          | [prettier.io](https://prettier.io/)                          |
| Prettier 配置选项      | [Options](https://prettier.io/docs/en/options.html)          |
| eslint-config-prettier | [GitHub](https://github.com/prettier/eslint-config-prettier) |
| eslint-plugin-prettier | [GitHub](https://github.com/prettier/eslint-plugin-prettier) |
