# ESLint 配置

## 依赖包

```json
{
  "devDependencies": {
    "eslint": "^9.39.2",
    "@eslint/js": "^9.39.2",
    "typescript": "^5.9.3",
    "typescript-eslint": "^8.49.0"
  }
}
```

| 包名 | 说明 |
|------|------|
| `eslint` | ESLint 核心包 |
| `@eslint/js` | ESLint 官方 JavaScript 规则集 |
| `typescript` | TypeScript 编译器 |
| `typescript-eslint` | TypeScript ESLint 统一包（替代旧的 `@typescript-eslint/parser` 和 `@typescript-eslint/eslint-plugin`） |

## 配置文件

ESLint v9 使用新的 **Flat Config** 格式，配置文件为 `eslint.config.js`。

```javascript
// eslint.config.js
// @ts-check
import { defineConfig, globalIgnores } from 'eslint/config'
import eslint from '@eslint/js'
import tseslint from 'typescript-eslint'

export default defineConfig([
  // ESLint 推荐规则
  eslint.configs.recommended,

  // TypeScript 推荐规则
  ...tseslint.configs.recommended,

  // 忽略文件
  globalIgnores([
    'node_modules/',
    'pnpm-lock.yaml',
    'dist/',
    'build/',
    '*.config.js',
  ]),
])
```

## 配置说明

### defineConfig

`defineConfig` 是 ESLint 9.1.0+ 提供的辅助函数，用于：
- 提供更好的 TypeScript 类型支持
- 在 IDE 中实现自动补全
- 配置验证

```javascript
import { defineConfig } from 'eslint/config'

export default defineConfig([...])
```

### globalIgnores

`globalIgnores` 用于全局忽略文件，替代旧的 `.eslintignore` 文件：

```javascript
import { globalIgnores } from 'eslint/config'

export default defineConfig([
  globalIgnores(['node_modules/', 'dist/'])
])
```

### tseslint.configs.recommended

`typescript-eslint` 提供的推荐配置，包含：
- TypeScript 解析器配置
- TypeScript ESLint 插件
- 推荐的 TypeScript 规则集

```javascript
import tseslint from 'typescript-eslint'

export default defineConfig([
  ...tseslint.configs.recommended
])
```

### 可选：tseslint.config()

`typescript-eslint` 也提供了自己的 `config` 函数：

```javascript
import tseslint from 'typescript-eslint'

export default tseslint.config(
  eslint.configs.recommended,
  ...tseslint.configs.recommended,
  { ignores: ['node_modules/', 'dist/'] }
)
```

## files 字段

默认情况下：
- `eslint.configs.recommended` 检查 `.js`, `.mjs`, `.cjs` 文件
- `tseslint.configs.recommended` 检查 `.ts`, `.tsx`, `.mts`, `.cts` 文件

如需自定义，可以添加 `files` 字段：

```javascript
export default defineConfig([
  // 只对特定文件应用规则
  {
    files: ['**/*.ts', '**/*.tsx'],
    rules: {
      '@typescript-eslint/no-explicit-any': 'error'
    }
  },

  // 为测试文件放宽规则
  {
    files: ['**/*.test.ts', '**/*.spec.ts'],
    rules: {
      '@typescript-eslint/no-explicit-any': 'off'
    }
  }
])
```

## 运行命令

```bash
# package.json scripts
"lint": "eslint . --max-warnings=0"

# 执行 lint
pnpm run lint

# 自动修复
pnpm run lint -- --fix
```

## ESLint v8 vs v9 对比

| 特性 | ESLint v8 (旧) | ESLint v9 (新) |
|------|----------------|----------------|
| 配置文件 | `.eslintrc.js`, `.eslintrc.json` | `eslint.config.js` |
| 配置格式 | eslintrc 格式 | Flat Config 格式 |
| 忽略文件 | `.eslintignore` | `globalIgnores()` 或 `ignores` 字段 |
| 模块系统 | CommonJS | ES Modules |
| 辅助函数 | 无 | `defineConfig`, `globalIgnores` |
| TypeScript 包 | `@typescript-eslint/parser` + `@typescript-eslint/eslint-plugin` | `typescript-eslint` (统一包) |

## 官方文档

### ESLint

| 文档 | 链接 |
|------|------|
| 配置文件指南 | [Configuration Files](https://eslint.org/docs/latest/use/configure/configuration-files) |
| 迁移指南 | [Migration Guide](https://eslint.org/docs/latest/use/configure/migration-guide) |
| Flat Config 新特性 | [Evolving flat config](https://eslint.org/blog/2025/03/flat-config-extends-define-config-global-ignores/) |
| Flat Config 介绍 | [Introduction to flat config](https://eslint.org/blog/2022/08/new-config-system-part-2/) |

### TypeScript-ESLint

| 文档 | 链接 |
|------|------|
| 快速开始 | [Getting Started](https://typescript-eslint.io/getting-started/) |
| typescript-eslint 包 | [Package Docs](https://typescript-eslint.io/packages/typescript-eslint/) |
| 共享配置 | [Shared Configs](https://typescript-eslint.io/users/configs/) |
| 类型检查 Linting | [Typed Linting](https://typescript-eslint.io/getting-started/typed-linting/) |

### 中文文档

- [ESLint 中文站](https://zh-hans.eslint.org/docs/latest/use/configure/configuration-files)
