# Commitlint 配置

## 依赖包

### @commitlint/cli

commitlint 的命令行工具，用于校验 Git commit 信息是否符合规范。

### @commitlint/config-conventional

commitlint 的预设配置，基于 [Conventional Commits](https://www.conventionalcommits.org/) 规范。

### commitizen

交互式命令行工具，通过问答形式帮助用户创建符合规范的提交信息，避免手动输入错误。

### cz-conventional-changelog

Commitizen 的适配器，提供符合 Conventional Commits 规范的交互式提示。

## commitlint.config.js

配置文件使用 ES Module 格式，继承了 `@commitlint/config-conventional` 预设。

```javascript
export default {
  extends: ['@commitlint/config-conventional'],
}
```

- `extends`: 继承预设配置规则

## .czrc

Commitizen 的配置文件，使用 JSON 格式，指定使用 cz-conventional-changelog 适配器。

```json
{
  "path": "cz-conventional-changelog"
}
```

- `path`: 指定 Commitizen 使用的适配器

**注意**：Commitizen 不支持 `.cz.yaml` 格式，必须使用 `.czrc`（JSON 格式）。

## 交互式提交（Commitizen）

使用 Commitizen 可以通过交互式命令行界面创建符合规范的提交信息，避免手动输入错误。

### 使用方式

在 package.json 中配置了 `commit` 脚本：

```json
{
  "scripts": {
    "commit": "cz"
  }
}
```

执行以下命令启动交互式提交：

```bash
pnpm run commit
# 或
pnpm commit
```

### 交互流程

Commitizen 会引导您完成以下步骤：

1. **选择提交类型**：从 feat, fix, docs, style, refactor, perf, test, chore 等中选择
2. **输入影响范围**（可选）：如 auth, api, ui 等
3. **编写简短描述**（必填）：描述本次提交的主要内容
4. **编写详细描述**（可选）：提供更详细的说明
5. **是否有破坏性变更**（可选）：如果有不兼容的改动，需要说明
6. **关联的 issue**（可选）：如 #123

### 示例交互

```bash
$ pnpm commit

? Select the type of change that you're committing: (Use arrow keys)
❯ feat:     A new feature
  fix:      A bug fix
  docs:     Documentation only changes
  style:    Changes that do not affect the meaning of the code
  refactor: A code change that neither fixes a bug nor adds a feature
  perf:     A code change that improves performance
  test:     Adding missing tests

? What is the scope of this change (e.g. component or file name): (press enter to skip)
  auth

? Write a short, imperative tense description of the change:
  add login feature

? Provide a longer description of the change: (press enter to skip)

? Are there any breaking changes? No

? Does this change affect any open issues? No
```

最终生成的提交信息：`feat(auth): add login feature`

## Husky 集成

在 `.husky/commit-msg` 中配置了 commitlint 钩子：

```bash
pnpm exec commitlint --edit $1
```

当执行 `git commit` 时，commitlint 会自动校验提交信息。如果不符合规范，提交将被拒绝。

## 跳过校验

在特殊情况下需要跳过 commitlint 校验：

```bash
git commit --no-verify -m "emergency fix"
```

不建议经常使用 `--no-verify`，应尽量遵循提交规范。

## 参考资料

- [Commitlint 官方文档](https://commitlint.js.org/)
- [Conventional Commits 规范](https://www.conventionalcommits.org/)
- [@commitlint/config-conventional](https://github.com/conventional-changelog/commitlint/tree/master/@commitlint/config-conventional)
- [Commitizen 官方文档](https://commitizen-tools.github.io/commitizen/)
- [cz-conventional-changelog](https://github.com/commitizen/cz-conventional-changelog)
