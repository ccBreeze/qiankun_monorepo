# TypeScript é…ç½®ä½“ç³»

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜é¡¹ç›®ä¸­ TypeScript é…ç½®æ–‡ä»¶çš„ç»„ç»‡ç»“æ„ã€ç»§æ‰¿å…³ç³»å’Œä½¿ç”¨è§„èŒƒã€‚

## ğŸ“ é…ç½®æ–‡ä»¶ç»“æ„

```
learn_monorepo/
â”œâ”€â”€ tsconfig.base.json          # åŸºç¡€é…ç½®ï¼šé€šç”¨ç¼–è¯‘é€‰é¡¹
â”œâ”€â”€ tsconfig.lib.json           # åº“é…ç½®ï¼šç”¨äº packagesï¼ŒåŒ…å«å£°æ˜è¾“å‡º
â”œâ”€â”€ tsconfig.node.base.json     # Node.js é…ç½®ï¼šç”¨äºæ„å»ºå·¥å…·
â”œâ”€â”€ tsconfig.json               # æ ¹é…ç½®ï¼šé¡¹ç›®å¼•ç”¨å…¥å£
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â””â”€â”€ tsconfig.json       # ç»§æ‰¿ tsconfig.lib.json
â”‚   â””â”€â”€ eslint-config/
â”‚       â””â”€â”€ tsconfig.json       # ç‰¹æ®Šé…ç½®ï¼šç›´æ¥ç»§æ‰¿ base
â””â”€â”€ apps/
    â”œâ”€â”€ vue3-app/
    â”‚   â”œâ”€â”€ tsconfig.json       # é¡¹ç›®å¼•ç”¨é…ç½®
    â”‚   â”œâ”€â”€ tsconfig.app.json   # åº”ç”¨ä»£ç é…ç½®
    â”‚   â””â”€â”€ tsconfig.node.json  # æ„å»ºå·¥å…·é…ç½®
    â””â”€â”€ ex-app/
        â””â”€â”€ tsconfig.json       # ç»§æ‰¿ tsconfig.lib.json
```

## ğŸ”— ç»§æ‰¿å…³ç³»å›¾

```mermaid
graph TD
    A[tsconfig.base.json<br/>åŸºç¡€é…ç½®] --> B[tsconfig.lib.json<br/>åº“é…ç½®]
    A --> C[tsconfig.node.base.json<br/>Node.jsé…ç½®]

    B --> D[packages/utils/tsconfig.json]
    B --> E[apps/ex-app/tsconfig.json]

    A --> F[packages/eslint-config/tsconfig.json<br/>ç‰¹æ®Šï¼šnoEmit]

    G[@vue/tsconfig/tsconfig.dom.json] --> H[apps/vue3-app/tsconfig.app.json]
    C --> I[apps/vue3-app/tsconfig.node.json]

    style A fill:#e1f5ff
    style B fill:#fff4e1
    style C fill:#f0ffe1
    style F fill:#ffe1e1
```

## ğŸ“„ é…ç½®æ–‡ä»¶è¯¦è§£

### 1. tsconfig.base.json - åŸºç¡€é…ç½®

**ç”¨é€”**ï¼šæ‰€æœ‰ TypeScript é…ç½®çš„åŸºç¡€ï¼ŒåŒ…å«é€šç”¨ç¼–è¯‘é€‰é¡¹ã€‚

**ç‰¹ç‚¹**ï¼š

- âœ… åªåŒ…å« ES ç‰¹æ€§ï¼Œä¸åŒ…å« DOM
- âœ… é€‚ç”¨äºæ‰€æœ‰ç¯å¢ƒï¼ˆNode.js + æµè§ˆå™¨ï¼‰
- âœ… ä¸¥æ ¼çš„ç±»å‹æ£€æŸ¥

```json
{
  "$schema": "https://json.schemastore.org/tsconfig",
  "compilerOptions": {
    "target": "ESNext", // ç¼–è¯‘ç›®æ ‡ï¼šæœ€æ–° ES ç‰ˆæœ¬
    "lib": ["ES2023"], // ç±»å‹åº“ï¼šåªæœ‰ ES2023ï¼Œä¸åŒ…å« DOM
    "module": "ESNext", // æ¨¡å—ç³»ç»Ÿ
    "moduleResolution": "Bundler", // æ¨¡å—è§£æç­–ç•¥ï¼ˆé€‚é… Vite/Rollupï¼‰

    "resolveJsonModule": true, // å…è®¸å¯¼å…¥ JSON
    "allowSyntheticDefaultImports": true,
    "isolatedModules": true, // æ¯ä¸ªæ–‡ä»¶ä½œä¸ºç‹¬ç«‹æ¨¡å—

    "strict": true, // å¯ç”¨æ‰€æœ‰ä¸¥æ ¼ç±»å‹æ£€æŸ¥
    "skipLibCheck": true // è·³è¿‡ .d.ts æ–‡ä»¶æ£€æŸ¥ï¼ˆæå‡æ€§èƒ½ï¼‰
  }
}
```

**å…³é”®é…ç½®è¯´æ˜**ï¼š

| é…ç½®é¡¹             | å€¼           | è¯´æ˜                                     |
| ------------------ | ------------ | ---------------------------------------- |
| `target`           | `ESNext`     | ç¼–è¯‘åˆ°æœ€æ–° ES ç‰ˆæœ¬ï¼Œè®©æ‰“åŒ…å·¥å…·å¤„ç†å…¼å®¹æ€§ |
| `lib`              | `["ES2023"]` | åªåŒ…å« ES2023 ç±»å‹ï¼Œä¸åŒ…å« DOM           |
| `moduleResolution` | `Bundler`    | é€‚é…ç°ä»£æ‰“åŒ…å·¥å…·ï¼ˆViteã€Rollupï¼‰         |
| `isolatedModules`  | `true`       | ç¡®ä¿æ¯ä¸ªæ–‡ä»¶å¯ç‹¬ç«‹ç¼–è¯‘ï¼ˆé€‚é… Viteï¼‰      |

### 2. tsconfig.lib.json - åº“é…ç½®

**ç”¨é€”**ï¼šä¸ºå¯å¤ç”¨çš„åº“/åŒ…æä¾›é…ç½®ï¼Œå¯ç”¨å£°æ˜æ–‡ä»¶ç”Ÿæˆå’Œé¡¹ç›®å¼•ç”¨ã€‚

**ç»§æ‰¿**ï¼š`tsconfig.base.json`

**ç‰¹ç‚¹**ï¼š

- âœ… å¯ç”¨ `composite` æ¨¡å¼ï¼ˆæ”¯æŒé¡¹ç›®å¼•ç”¨ï¼‰
- âœ… ç”Ÿæˆ `.d.ts` å£°æ˜æ–‡ä»¶
- âœ… ç”Ÿæˆå£°æ˜æ˜ å°„æ–‡ä»¶ï¼ˆä¾¿äºè°ƒè¯•ï¼‰
- âœ… åªè¾“å‡ºå£°æ˜æ–‡ä»¶ï¼ˆæºç ç”±æ‰“åŒ…å·¥å…·å¤„ç†ï¼‰

```json
{
  "extends": "./tsconfig.base.json",
  "compilerOptions": {
    "composite": true, // å¯ç”¨é¡¹ç›®å¼•ç”¨
    "incremental": true, // å¢é‡ç¼–è¯‘ï¼ˆæå‡æ€§èƒ½ï¼‰
    "declaration": true, // ç”Ÿæˆ .d.ts å£°æ˜æ–‡ä»¶
    "declarationMap": true, // ç”Ÿæˆ .d.ts.map æ˜ å°„æ–‡ä»¶
    "emitDeclarationOnly": true, // åªè¾“å‡ºå£°æ˜æ–‡ä»¶
    "noEmitOnError": true // æœ‰é”™è¯¯æ—¶ä¸è¾“å‡º
  }
}
```

**ä½•æ—¶ä½¿ç”¨**ï¼š

- âœ… `packages/*` ä¸­çš„å¯å¤ç”¨åº“
- âœ… éœ€è¦è¢«å…¶ä»–åŒ…å¼•ç”¨çš„æ¨¡å—
- âœ… éœ€è¦æä¾›ç±»å‹å£°æ˜çš„åŒ…

### 3. tsconfig.node.base.json - Node.js é…ç½®

**ç”¨é€”**ï¼šä¸º Node.js ç¯å¢ƒçš„ä»£ç æä¾›é…ç½®ï¼ˆå¦‚ Vite é…ç½®æ–‡ä»¶ï¼‰ã€‚

**ç»§æ‰¿**ï¼š`tsconfig.base.json`

```json
{
  "extends": "./tsconfig.base.json",
  "compilerOptions": {
    "composite": true,
    "lib": ["ES2023"], // Node.js ä¸éœ€è¦ DOM
    "module": "ESNext",
    "moduleResolution": "Bundler",

    "types": ["node"], // åŒ…å« Node.js ç±»å‹å®šä¹‰
    "allowImportingTsExtensions": true,
    "noEmit": true // ä¸è¾“å‡ºæ–‡ä»¶ï¼ˆå¼€å‘æ—¶ä½¿ç”¨ï¼‰
  }
}
```

## ğŸ¯ ä½¿ç”¨è§„èŒƒ

### æ–°å¢ Package é…ç½®æ¨¡æ¿

#### åœºæ™¯ 1ï¼šæ™®é€šå·¥å…·åº“

```json
{
  "extends": "../../tsconfig.lib.json",
  "include": ["src/**/*.ts"],
  "exclude": ["node_modules", "dist"]
}
```

#### åœºæ™¯ 2ï¼šESLint/é…ç½®åŒ…ï¼ˆä¸éœ€è¦è¾“å‡ºæ–‡ä»¶ï¼‰

```json
{
  "extends": "../../tsconfig.base.json",
  "compilerOptions": {
    "allowImportingTsExtensions": true,
    "noEmit": true
  },
  "include": ["src/**/*.ts"],
  "exclude": ["node_modules"]
}
```

### æ–°å¢ App é…ç½®æ¨¡æ¿

#### Vue3 åº”ç”¨ï¼ˆä½¿ç”¨ Viteï¼‰

**tsconfig.json**ï¼ˆé¡¹ç›®å¼•ç”¨å…¥å£ï¼‰ï¼š

```json
{
  "files": [],
  "references": [
    { "path": "./tsconfig.node.json" }, // æ„å»ºå·¥å…·é…ç½®
    { "path": "./tsconfig.app.json" } // åº”ç”¨ä»£ç é…ç½®
  ]
}
```

**tsconfig.app.json**ï¼ˆåº”ç”¨ä»£ç ï¼‰ï¼š

```json
{
  "extends": "@vue/tsconfig/tsconfig.dom.json",
  "include": ["env.d.ts", "src/**/*", "src/**/*.vue"],
  "compilerOptions": {
    "paths": {
      "@/*": ["./src/*"]
    }
  }
}
```

**tsconfig.node.json**ï¼ˆæ„å»ºå·¥å…·ï¼‰ï¼š

```json
{
  "extends": "../../tsconfig.node.base.json",
  "include": ["vite.config.ts", "*.config.js", "*.config.ts"],
  "compilerOptions": {
    "composite": true,
    "module": "ESNext",
    "moduleResolution": "Bundler"
  }
}
```

## ğŸ” å…³é”®æ¦‚å¿µè§£æ

### 1. Project Referencesï¼ˆé¡¹ç›®å¼•ç”¨ï¼‰

**å¯ç”¨æ–¹å¼**ï¼šè®¾ç½® `"composite": true`

**ä½œç”¨**ï¼š

- âœ… æ”¯æŒè·¨åŒ…ç±»å‹æ£€æŸ¥
- âœ… å¢é‡ç¼–è¯‘ï¼ˆåªé‡æ–°ç¼–è¯‘ä¿®æ”¹çš„éƒ¨åˆ†ï¼‰
- âœ… å¼ºåˆ¶å£°æ˜æ–‡ä»¶ç”Ÿæˆ
- âœ… æ›´å¥½çš„ IDE æ”¯æŒ

**ç¤ºä¾‹**ï¼š

```json
// apps/vue3-app å¼•ç”¨ packages/utils
{
  "references": [{ "path": "../../packages/utils" }]
}
```

### 2. Declaration Filesï¼ˆå£°æ˜æ–‡ä»¶ï¼‰

**é…ç½®é€‰é¡¹**ï¼š

```json
{
  "declaration": true, // ç”Ÿæˆ .d.ts
  "declarationMap": true, // ç”Ÿæˆ .d.ts.mapï¼ˆæ”¯æŒè·³è½¬åˆ°æºç ï¼‰
  "emitDeclarationOnly": true // åªç”Ÿæˆå£°æ˜æ–‡ä»¶
}
```

**è¾“å‡ºç¤ºä¾‹**ï¼š

```
packages/utils/
â”œâ”€â”€ src/
â”‚   â””â”€â”€ index.ts              # æºç 
â””â”€â”€ dist/
    â”œâ”€â”€ index.d.ts            # ç”Ÿæˆçš„å£°æ˜æ–‡ä»¶
    â””â”€â”€ index.d.ts.map        # å£°æ˜æ˜ å°„æ–‡ä»¶
```

### 3. Module Resolutionï¼ˆæ¨¡å—è§£æï¼‰

**Bundler ç­–ç•¥** (`"moduleResolution": "Bundler"`)ï¼š

- âœ… æ”¯æŒ `package.json` çš„ `exports` å­—æ®µ
- âœ… æ”¯æŒæ— æ‰©å±•åå¯¼å…¥
- âœ… é€‚é…ç°ä»£æ‰“åŒ…å·¥å…·ï¼ˆViteã€Rollupã€esbuildï¼‰

```typescript
// æ”¯æŒä»¥ä¸‹å¯¼å…¥æ–¹å¼
import { utils } from '@breeze/utils' // âœ… åŒ…å¯¼å…¥
import { helper } from './helper' // âœ… æ— æ‰©å±•å
import config from './config.json' // âœ… JSON å¯¼å…¥
```

## âš™ï¸ å¸¸è§é…ç½®é€‰é¡¹é€ŸæŸ¥

| é€‰é¡¹               | æ¨èå€¼                             | è¯´æ˜                         |
| ------------------ | ---------------------------------- | ---------------------------- |
| `target`           | `ESNext`                           | ç¼–è¯‘ç›®æ ‡ï¼Œè®©æ‰“åŒ…å·¥å…·å¤„ç†é™çº§ |
| `module`           | `ESNext`                           | ä½¿ç”¨ ES æ¨¡å—                 |
| `lib`              | `["ES2023"]` / `["ES2023", "DOM"]` | åŸºç¡€ï¼šåª ESï¼›åº”ç”¨ï¼šåŠ  DOM    |
| `moduleResolution` | `Bundler`                          | é€‚é…ç°ä»£æ‰“åŒ…å·¥å…·             |
| `strict`           | `true`                             | å¯ç”¨æ‰€æœ‰ä¸¥æ ¼æ£€æŸ¥             |
| `composite`        | åº“ï¼š`true`ï¼›åº”ç”¨ï¼šçœ‹æƒ…å†µ           | å¯ç”¨é¡¹ç›®å¼•ç”¨                 |
| `declaration`      | åº“ï¼š`true`ï¼›åº”ç”¨ï¼š`false`          | ç”Ÿæˆå£°æ˜æ–‡ä»¶                 |
| `noEmit`           | é…ç½®åŒ…ï¼š`true`ï¼›å…¶ä»–ï¼š`false`      | æ˜¯å¦è¾“å‡ºæ–‡ä»¶                 |
| `isolatedModules`  | `true`                             | ç¡®ä¿æ–‡ä»¶å¯ç‹¬ç«‹ç¼–è¯‘           |
| `skipLibCheck`     | `true`                             | è·³è¿‡ .d.ts æ£€æŸ¥ï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰  |

## ğŸš¨ å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆ base ä¸åŒ…å« DOMï¼Ÿ

**A**: ä¿æŒåŸºç¡€é…ç½®çš„é€šç”¨æ€§ï¼š

- âœ… å·¥å…·åº“ä¸åº”ä¾èµ–æµè§ˆå™¨ API
- âœ… é¿å…åœ¨ Node.js åŒ…ä¸­æ„å¤–ä½¿ç”¨ DOM
- âœ… éœ€è¦ DOM çš„åº”ç”¨è‡ªè¡Œæ·»åŠ 

**è§£å†³æ–¹æ¡ˆ**ï¼š

```json
// apps/*/tsconfig.json
{
  "compilerOptions": {
    "lib": ["ES2023", "DOM", "DOM.Iterable"]
  }
}
```

### Q2: ä»€ä¹ˆæ—¶å€™ä½¿ç”¨ tsconfig.lib.jsonï¼Ÿ

**A**: å½“ä½ çš„åŒ…éœ€è¦ï¼š

- âœ… è¢«å…¶ä»–åŒ…å¼•ç”¨
- âœ… æä¾›ç±»å‹å£°æ˜æ–‡ä»¶
- âœ… æ”¯æŒå¢é‡ç¼–è¯‘

**ä¸éœ€è¦ä½¿ç”¨çš„åœºæ™¯**ï¼š

- âŒ çº¯é…ç½®æ–‡ä»¶åŒ…ï¼ˆå¦‚ eslint-configï¼‰
- âŒ ä¸éœ€è¦ç±»å‹å£°æ˜çš„åº”ç”¨

### Q3: emitDeclarationOnly vs noEmit çš„åŒºåˆ«ï¼Ÿ

| é…ç½®                        | è¾“å‡º .js | è¾“å‡º .d.ts | é€‚ç”¨åœºæ™¯                    |
| --------------------------- | -------- | ---------- | --------------------------- |
| `emitDeclarationOnly: true` | âŒ       | âœ…         | åº“/åŒ…ï¼ˆæºç ç”±æ‰“åŒ…å·¥å…·å¤„ç†ï¼‰ |
| `noEmit: true`              | âŒ       | âŒ         | é…ç½®æ–‡ä»¶ã€å¼€å‘æ—¶ç±»å‹æ£€æŸ¥    |
| éƒ½ä¸è®¾ç½®                    | âœ…       | âœ…         | ä¼ ç»Ÿ TS é¡¹ç›®                |

### Q4: ä¸ºä»€ä¹ˆ eslint-config ä¸ç»§æ‰¿ tsconfig.lib.jsonï¼Ÿ

**A**: å› ä¸º ESLint é…ç½®åŒ…çš„ç‰¹æ®Šæ€§ï¼š

- âœ… ä½¿ç”¨ `.ts` æ‰©å±•åå¯¼å…¥ï¼ˆéœ€è¦ `allowImportingTsExtensions`ï¼‰
- âœ… ä¸éœ€è¦ç¼–è¯‘è¾“å‡ºï¼ˆè®¾ç½® `noEmit: true`ï¼‰
- âœ… ç›´æ¥ç”± ESLint ä½¿ç”¨æºç 

```json
{
  "extends": "../../tsconfig.base.json",
  "compilerOptions": {
    "allowImportingTsExtensions": true,
    "noEmit": true
  }
}
```

## ğŸ“š æœ€ä½³å®è·µæ€»ç»“

### âœ… DOï¼ˆæ¨èåšæ³•ï¼‰

1. **ç»§æ‰¿è€Œéå¤åˆ¶**ï¼šä½¿ç”¨ `extends` ç»§æ‰¿åŸºç¡€é…ç½®
2. **æœ€å°åŒ–é…ç½®**ï¼šåªåœ¨å¿…è¦æ—¶è¦†ç›–é€‰é¡¹
3. **é¡¹ç›®å¼•ç”¨**ï¼šä¸ºåº“å¯ç”¨ `composite` æ¨¡å¼
4. **å£°æ˜æ–‡ä»¶**ï¼šåº“å¿…é¡»è¾“å‡º `.d.ts` æ–‡ä»¶
5. **è·¯å¾„åˆ«å**ï¼šåœ¨åº”ç”¨çº§é…ç½®ä¸­å®šä¹‰ `paths`

### âŒ DON'Tï¼ˆé¿å…åšæ³•ï¼‰

1. **ä¸è¦åœ¨ base ä¸­æ·»åŠ ç‰¹å®šç¯å¢ƒé…ç½®**ï¼ˆå¦‚ DOMã€Nodeï¼‰
2. **ä¸è¦ç¦ç”¨ `strict` æ¨¡å¼**
3. **ä¸è¦åœ¨åº“ä¸­ä½¿ç”¨ `noEmit`**ï¼ˆä¼šå¯¼è‡´æ— æ³•ç”Ÿæˆå£°æ˜æ–‡ä»¶ï¼‰
4. **ä¸è¦åœ¨å¤šä¸ªåœ°æ–¹é‡å¤ç›¸åŒé…ç½®**
5. **ä¸è¦åœ¨åº”ç”¨ä¸­ä½¿ç”¨ `emitDeclarationOnly`**

## ğŸ—ï¸ Monorepo TypeScript é…ç½®ç­–ç•¥

æœ¬é¡¹ç›®çš„ TypeScript é…ç½®ç­–ç•¥å‚è€ƒäº† TypeScript ESLint å’Œç°ä»£ Monorepo æœ€ä½³å®è·µã€‚

### è®¾è®¡ç†å¿µ

#### 1. **åˆ†å±‚ç»§æ‰¿æ¶æ„**

æˆ‘ä»¬é‡‡ç”¨ä¸‰å±‚é…ç½®æ¶æ„ï¼š

```
Layer 1: tsconfig.base.json (åŸºç¡€å±‚)
         â””â”€ é€šç”¨ç¼–è¯‘é€‰é¡¹ï¼Œé€‚ç”¨äºæ‰€æœ‰ç¯å¢ƒ

Layer 2: tsconfig.lib.json / tsconfig.node.base.json (ä¸“ç”¨å±‚)
         â””â”€ é’ˆå¯¹ç‰¹å®šåœºæ™¯çš„æ‰©å±•é…ç½®

Layer 3: packages/*/tsconfig.json, apps/*/tsconfig.json (å®ç°å±‚)
         â””â”€ å…·ä½“åŒ…å’Œåº”ç”¨çš„é…ç½®
```

**ä¼˜åŠ¿**ï¼š

- âœ… é…ç½®å¤ç”¨ï¼Œå‡å°‘é‡å¤
- âœ… ç»Ÿä¸€åŸºç¡€è§„åˆ™ï¼Œä¾¿äºç»´æŠ¤
- âœ… çµæ´»æ‰©å±•ï¼Œæ»¡è¶³ä¸åŒéœ€æ±‚

#### 2. **Project Service APIï¼ˆTypeScript ESLint v8+ï¼‰**

æœ¬é¡¹ç›®ä½¿ç”¨äº† typescript-eslint v8.0+ å¼•å…¥çš„ **Project Service API**ï¼Œè¿™æ˜¯ 2024 å¹´æœ€é‡è¦çš„é…ç½®ç®€åŒ–ç‰¹æ€§ã€‚

> ğŸ’¡ **é‡è¦æ›´æ–°**ï¼šå¦‚æœä½ ä½¿ç”¨ `parserOptions.projectService`ï¼Œå°±ä¸å†éœ€è¦å¤æ‚çš„ monorepo é…ç½®äº†ï¼

**ä»€ä¹ˆæ˜¯ Project Serviceï¼Ÿ**

Project Service æ˜¯å¯¹ TypeScript ç¼–è¾‘å™¨æœåŠ¡ API çš„å°è£…ï¼Œä¸ VS Code ç­‰ç¼–è¾‘å™¨ä½¿ç”¨ç›¸åŒçš„ç±»å‹ä¿¡æ¯æœåŠ¡ã€‚è¿™æ„å‘³ç€ï¼š

- âœ… ESLint çœ‹åˆ°çš„ç±»å‹ä¿¡æ¯ä¸ç¼–è¾‘å™¨å®Œå…¨ä¸€è‡´
- âœ… è‡ªåŠ¨æ”¯æŒ TypeScript Project References
- âœ… æ— éœ€åˆ›å»º `tsconfig.eslint.json` æ–‡ä»¶

**ä¼ ç»Ÿæ–¹å¼ vs Project Service**ï¼š

```typescript
// âŒ ä¼ ç»Ÿæ–¹å¼ï¼šéœ€è¦æ‰‹åŠ¨æŒ‡å®š tsconfig è·¯å¾„å’Œ glob æ¨¡å¼
{
  languageOptions: {
    parserOptions: {
      project: ['./tsconfig.eslint.json', './packages/*/tsconfig.json'],
      tsconfigRootDir: __dirname,
    }
  }
}

// âœ… Project Serviceï¼ˆv8+ï¼‰ï¼šè‡ªåŠ¨å‘ç°é…ç½®ï¼Œé›¶é…ç½®
{
  languageOptions: {
    parserOptions: {
      projectService: true,  // ğŸ¯ å°±è¿™ä¹ˆç®€å•ï¼
    }
  }
}
```

**Project Service çš„ä¼˜åŠ¿**ï¼š

| ç‰¹æ€§                              | ä¼ ç»Ÿæ–¹å¼ (`project`)            | Project Service (`projectService`) |
| --------------------------------- | ------------------------------- | ---------------------------------- |
| **é…ç½®å¤æ‚åº¦**                    | âŒ éœ€è¦æ‰‹åŠ¨é…ç½®è·¯å¾„å’Œ glob æ¨¡å¼ | âœ… é›¶é…ç½®ï¼Œè‡ªåŠ¨å‘ç°                |
| **Monorepo æ”¯æŒ**                 | âŒ éœ€è¦ä¸ºæ¯ä¸ªåŒ…æŒ‡å®šè·¯å¾„         | âœ… è‡ªåŠ¨è¯†åˆ«æ‰€æœ‰åŒ…                  |
| **TypeScript Project References** | âš ï¸ éœ€è¦æ‰‹åŠ¨é…ç½®                 | âœ… åŸç”Ÿæ”¯æŒ                        |
| **æ€§èƒ½**                          | âš ï¸ å¯èƒ½é‡å¤è§£æï¼ŒOOM é£é™©       | âœ… æ™ºèƒ½ç¼“å­˜ï¼Œä¸ç¼–è¾‘å™¨å…±äº«çŠ¶æ€      |
| **ç»´æŠ¤æˆæœ¬**                      | âŒ é«˜ï¼ˆè·¯å¾„å˜æ›´éœ€æ›´æ–°é…ç½®ï¼‰     | âœ… ä½ï¼ˆè‡ªåŠ¨åŒæ­¥ï¼‰                  |
| **ç±»å‹å‡†ç¡®æ€§**                    | âš ï¸ å¯èƒ½ä¸ç¼–è¾‘å™¨ä¸ä¸€è‡´           | âœ… ä¸ VS Code ä½¿ç”¨ç›¸åŒçš„ç±»å‹æœåŠ¡   |

**é¡¹ç›®ä¸­çš„ä½¿ç”¨**ï¼ˆ[packages/eslint-config/src/base.ts:22-28](../packages/eslint-config/src/base.ts#L22-L28)ï¼‰ï¼š

```typescript
{
  languageOptions: {
    parserOptions: {
      projectService: true, // å¯ç”¨ Project Service API
      // ä¸éœ€è¦æŒ‡å®š tsconfigRootDirï¼Œè®© Project Service è‡ªåŠ¨ä»å½“å‰å·¥ä½œç›®å½•æŸ¥æ‰¾
      // ä¸éœ€è¦æŒ‡å®š project è·¯å¾„ï¼Œè‡ªåŠ¨å‘ç°æ‰€æœ‰ tsconfig.json
    },
  },
}
```

**è¿ç§»å»ºè®®**ï¼š

å¦‚æœä½ çš„é¡¹ç›®è¿˜åœ¨ä½¿ç”¨ä¼ ç»Ÿçš„ `project` é…ç½®ï¼š

```diff
  parserOptions: {
-   project: ['./tsconfig.json', './packages/*/tsconfig.json'],
-   tsconfigRootDir: __dirname,
+   projectService: true,
  }
```

ç„¶ååˆ é™¤ä¸å†éœ€è¦çš„ `tsconfig.eslint.json` æ–‡ä»¶ï¼

#### 3. **ç±»å‹åŒ– Linting åœ¨ Monorepo ä¸­çš„é…ç½®**

**ç±»å‹åŒ– Linting**ï¼ˆTyped Lintingï¼‰æ˜¯ TypeScript ESLint çš„å¼ºå¤§åŠŸèƒ½ï¼Œå¯ä»¥åŸºäºç±»å‹ä¿¡æ¯è¿›è¡Œæ›´æ·±å…¥çš„ä»£ç æ£€æŸ¥ã€‚

**é…ç½®è¦ç‚¹**ï¼š

1. **å¯ç”¨ Project Service**ï¼ˆæ¨èï¼‰

   ```typescript
   parserOptions: {
     projectService: true,
   }
   ```

2. **ä½¿ç”¨ç±»å‹æ„ŸçŸ¥è§„åˆ™**

   ```typescript
   // é¡¹ç›®ä¸­å·²é€šè¿‡ @breeze/eslint-config å¯ç”¨
   import tseslint from 'typescript-eslint'

   export default [
     ...tseslint.configs.recommended, // åŸºç¡€è§„åˆ™
     ...tseslint.configs.strict, // ä¸¥æ ¼è§„åˆ™ï¼ˆå¯é€‰ï¼‰
   ]
   ```

3. **ç¡®ä¿æ¯ä¸ªåŒ…éƒ½æœ‰ tsconfig.json**
   - âœ… æ‰€æœ‰ `packages/*` éƒ½é…ç½®äº† tsconfig
   - âœ… æ‰€æœ‰ `apps/*` éƒ½é…ç½®äº† tsconfig
   - âœ… æ„å»ºå·¥å…·é…ç½®ç‹¬ç«‹ï¼ˆå¦‚ `vite.config.ts` ä½¿ç”¨ `tsconfig.node.json`ï¼‰

**å¸¸è§çš„ç±»å‹æ„ŸçŸ¥è§„åˆ™ç¤ºä¾‹**ï¼š

```typescript
{
  rules: {
    '@typescript-eslint/no-floating-promises': 'error',     // æ£€æµ‹æœªå¤„ç†çš„ Promise
    '@typescript-eslint/no-misused-promises': 'error',      // æ£€æµ‹é”™è¯¯ä½¿ç”¨çš„ Promise
    '@typescript-eslint/await-thenable': 'error',           // ç¡®ä¿ await ç”¨äº Promise
    '@typescript-eslint/no-unnecessary-condition': 'warn',  // æ£€æµ‹ä¸å¿…è¦çš„æ¡ä»¶åˆ¤æ–­
  }
}
```

#### 4. **æ€§èƒ½ä¼˜åŒ–ç­–ç•¥ï¼ˆ2025 æœ€ä½³å®è·µï¼‰**

**a) ä½¿ç”¨ ESLint ç¼“å­˜**

```bash
# package.json scripts
{
  "scripts": {
    "lint": "eslint . --cache --cache-location .eslintcache"
  }
}
```

**å¥½å¤„**ï¼šåªæ£€æŸ¥ä¿®æ”¹è¿‡çš„æ–‡ä»¶ï¼Œæ˜¾è‘—åŠ é€Ÿåç»­è¿è¡Œã€‚

**b) å¢é‡ç¼–è¯‘å’Œé¡¹ç›®å¼•ç”¨**

```json
{
  "compilerOptions": {
    "composite": true, // å¯ç”¨é¡¹ç›®å¼•ç”¨
    "incremental": true // å¯ç”¨å¢é‡ç¼–è¯‘
  }
}
```

**å¥½å¤„**ï¼šTypeScript åªé‡æ–°ç¼–è¯‘ä¿®æ”¹çš„éƒ¨åˆ†ï¼Œä¸æ˜¯æ•´ä¸ªé¡¹ç›®ã€‚

**c) è·³è¿‡åº“ç±»å‹æ£€æŸ¥**

```json
{
  "compilerOptions": {
    "skipLibCheck": true // è·³è¿‡ node_modules ä¸­çš„ .d.ts æ–‡ä»¶æ£€æŸ¥
  }
}
```

**å¥½å¤„**ï¼šå¤§å¹…æå‡æ€§èƒ½ï¼Œé€šå¸¸å¯èŠ‚çœ 50% ä»¥ä¸Šçš„ç±»å‹æ£€æŸ¥æ—¶é—´ã€‚

**d) éš”ç¦»æ¨¡å—ç¼–è¯‘**

```json
{
  "compilerOptions": {
    "isolatedModules": true // ç¡®ä¿æ¯ä¸ªæ–‡ä»¶å¯ç‹¬ç«‹ç¼–è¯‘
  }
}
```

**å¥½å¤„**ï¼šé€‚é… Viteã€esbuild ç­‰å¿«é€Ÿæ„å»ºå·¥å…·ï¼Œæ”¯æŒå¹¶è¡Œç¼–è¯‘ã€‚

**e) é¿å…ä½¿ç”¨å®½æ³›çš„ glob æ¨¡å¼**

```typescript
// âŒ é¿å…ï¼šé€’å½’æœç´¢æ‰€æœ‰æ–‡ä»¶å¤¹ï¼Œæ€§èƒ½å·®
parserOptions: {
  project: './packages/**/tsconfig.json',  // ä½¿ç”¨ ** ä¼šé™çº§æ€§èƒ½
}

// âœ… æ¨èï¼šä½¿ç”¨ Project Service è‡ªåŠ¨å‘ç°
parserOptions: {
  projectService: true,  // æ™ºèƒ½ç¼“å­˜ï¼Œæ€§èƒ½æœ€ä½³
}
```

**f) Monorepo å·¥å…·é›†æˆ**

å¦‚æœä½¿ç”¨ Turborepoã€Nx ç­‰å·¥å…·ï¼Œåˆ©ç”¨å®ƒä»¬çš„å¢é‡æ„å»ºï¼š

```bash
# åªæ£€æŸ¥å—å½±å“çš„åŒ…
pnpm turbo run lint

# æˆ–ä½¿ç”¨ Nx
nx affected:lint
```

**æ€§èƒ½å¯¹æ¯”**ï¼š

| ä¼˜åŒ–æªæ–½              | æ€§èƒ½æå‡      | å®æ–½éš¾åº¦ |
| --------------------- | ------------- | -------- |
| å¯ç”¨ `--cache`        | âš¡âš¡âš¡ 50-90% | ğŸŸ¢ ç®€å•  |
| ä½¿ç”¨ `projectService` | âš¡âš¡âš¡ 30-60% | ğŸŸ¢ ç®€å•  |
| å¯ç”¨ `skipLibCheck`   | âš¡âš¡ 20-50%   | ğŸŸ¢ ç®€å•  |
| å¯ç”¨ `incremental`    | âš¡âš¡ 20-40%   | ğŸŸ¡ ä¸­ç­‰  |
| Monorepo å·¥å…·å¢é‡æ„å»º | âš¡âš¡âš¡ 60-95% | ğŸŸ¡ ä¸­ç­‰  |

### Monorepo é…ç½®æ£€æŸ¥æ¸…å•

ä½¿ç”¨æ­¤æ¸…å•ç¡®ä¿ä½ çš„ Monorepo TypeScript é…ç½®æ­£ç¡®ï¼š

- [ ] **åŸºç¡€é…ç½®**
  - [ ] `tsconfig.base.json` åŒ…å«é€šç”¨ç¼–è¯‘é€‰é¡¹
  - [ ] ä¸åœ¨ base ä¸­åŒ…å«ç¯å¢ƒç‰¹å®šé…ç½®ï¼ˆDOMã€Nodeï¼‰

- [ ] **é¡¹ç›®ç»“æ„**
  - [ ] æ¯ä¸ª package éƒ½æœ‰ `tsconfig.json`
  - [ ] æ¯ä¸ª app éƒ½æœ‰ `tsconfig.json`
  - [ ] æ„å»ºå·¥å…·é…ç½®ç‹¬ç«‹ï¼ˆå¦‚ `tsconfig.node.json`ï¼‰

- [ ] **ESLint é›†æˆ**
  - [ ] å¯ç”¨ `projectService: true`
  - [ ] ä¸æ‰‹åŠ¨æŒ‡å®š `project` è·¯å¾„
  - [ ] ä½¿ç”¨ç±»å‹æ„ŸçŸ¥è§„åˆ™

- [ ] **æ€§èƒ½ä¼˜åŒ–**
  - [ ] åº“å¯ç”¨ `composite` å’Œ `incremental`
  - [ ] å…¨å±€å¯ç”¨ `skipLibCheck`
  - [ ] ä½¿ç”¨ `isolatedModules`

- [ ] **å£°æ˜æ–‡ä»¶**
  - [ ] åº“é…ç½® `declaration: true`
  - [ ] åº“é…ç½® `declarationMap: true`
  - [ ] åº”ç”¨ä¸ç”Ÿæˆå£°æ˜æ–‡ä»¶

## ğŸ”§ ç±»å‹æ£€æŸ¥å‘½ä»¤

```bash
# æ£€æŸ¥æ•´ä¸ªé¡¹ç›®
pnpm -w run type-check

# æ£€æŸ¥ç‰¹å®šåŒ…
npx tsc --project packages/utils/tsconfig.json --noEmit

# æ£€æŸ¥ç‰¹å®šåº”ç”¨
cd apps/vue3-app && npx tsc --noEmit

# æ£€æŸ¥å¹¶ç”Ÿæˆå£°æ˜æ–‡ä»¶
npx tsc --project packages/utils/tsconfig.json
```

## ğŸ“– å‚è€ƒèµ„æ–™

### å®˜æ–¹æ–‡æ¡£

- [TypeScript å®˜æ–¹æ–‡æ¡£ - tsconfig.json](https://www.typescriptlang.org/tsconfig)
- [TypeScript å®˜æ–¹æ–‡æ¡£ - Project References](https://www.typescriptlang.org/docs/handbook/project-references.html)
- [Vite å®˜æ–¹æ–‡æ¡£ - TypeScript](https://vitejs.dev/guide/features.html#typescript)

### Monorepo æœ€ä½³å®è·µ

æœ¬é¡¹ç›®çš„ TypeScript é…ç½®ç­–ç•¥å‚è€ƒäº†ä»¥ä¸‹èµ„æºï¼š

1. **[TypeScript ESLint - Monorepos ç±»å‹åŒ– Linting](https://typescript-eslint.io/troubleshooting/typed-linting/monorepos/)**
   - Monorepo ä¸­é…ç½®ç±»å‹æ„ŸçŸ¥ ESLint è§„åˆ™çš„æŒ‡å—
   - å¦‚ä½•æ­£ç¡®è®¾ç½® `parserOptions` ä»¥æ”¯æŒå¤šåŒ…é¡¹ç›®
   - å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

2. **[TypeScript ESLint - Project Service API](https://typescript-eslint.io/blog/project-service/)**
   - TypeScript 8.0+ å¼•å…¥çš„ Project Service API è¯¦è§£
   - è‡ªåŠ¨å‘ç° tsconfig é…ç½®ï¼Œç®€åŒ– Monorepo è®¾ç½®
   - æ€§èƒ½ä¼˜åŒ–å’Œæ™ºèƒ½ç¼“å­˜æœºåˆ¶

3. **[2025 Monorepo ESLint ç»ˆææŒ‡å—](https://junkangworld.com/blog/the-ultimate-2025-guide-to-eslint-generics-in-monorepos)**
   - ç°ä»£ Monorepo ä¸­ ESLint å’Œ TypeScript çš„æœ€æ–°é…ç½®å®è·µ
   - Flat Config æ¨¡å¼å’Œç±»å‹å®‰å…¨é…ç½®
   - æ€§èƒ½ä¼˜åŒ–å’Œå·¥å…·é“¾é›†æˆ

### ç›¸å…³æŠ€æœ¯æ–‡æ¡£

- [pnpm Workspace](https://pnpm.io/workspaces) - Monorepo åŒ…ç®¡ç†
- [typescript-eslint](https://typescript-eslint.io/) - TypeScript ESLint é›†æˆ
- [ESLint Flat Config](https://eslint.org/docs/latest/use/configure/configuration-files-new) - ESLint æ–°é…ç½®æ ¼å¼

---

**ç»´æŠ¤æ—¥å¿—**ï¼š

- 2025-12-24: åˆå§‹ç‰ˆæœ¬ï¼Œæ•´ç†é¡¹ç›® TypeScript é…ç½®ä½“ç³»
- 2025-12-24: è¡¥å…… Monorepo é…ç½®ç­–ç•¥å’Œå‚è€ƒèµ„æ–™
